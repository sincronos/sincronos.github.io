<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://sincronos.github.io/index.html">
<meta property="og:site_name">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title">
  
    <link rel="alternate" href="/atom.xml" title type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo"></a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://sincronos.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="integracao-acerto-fiscal-Acerto" class="article article-type-integracao-acerto-fiscal" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/03/31/Acerto/" class="article-date">
  <time datetime="2021-03-31T22:38:14.000Z" itemprop="datePublished">2021-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/31/Acerto/">Acerto Fiscal - Integração</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Integracao-Acerto-Fiscal"><a href="#Integracao-Acerto-Fiscal" class="headerlink" title="Integração Acerto Fiscal"></a>Integração Acerto Fiscal</h1><h2 id="Pela-camada-de-banco-de-dados"><a href="#Pela-camada-de-banco-de-dados" class="headerlink" title="Pela camada de banco de dados"></a>Pela camada de banco de dados</h2><p>O processo de homologação na camada de banco de dados se dá pela elaboração das chamadas<br>stored procedures (Procedimentos armazenados), também conhecidas apenas por procedures. As<br>procedures são um conjunto de coordenadas procedurais escritas em SQL para manipular,<br>extrair ou armazenar dados em um banco de dados.</p>
<p>Como cada banco possui uma distribuição específica de tabelas de acordo com o software usado,<br>fica a cargo da Software House desenvolver a procedure seguindo a sintaxe do banco de dados e<br>conhecimento tácito do modelo de negócio aplicada à camada de dados.</p>
<p>Corretor Fiscal ™<br>O corretor fiscal é o programa desktop implantado no cliente responsável por executar as<br>procedures e fazer a comunicação do Acerto Fiscal com o banco de dados local do cliente. O<br>Corretor Fiscal geralmente fica instalado no servidor do cliente, ou em uma das máquinas da<br>rede, com acesso ao banco de dados.</p>
<p>Enviando dados para o acerto - <strong>CORRETORFISCAL_PRODUTOS</strong></p>
<p>Para enviar dados para o acerto o Corretor Fiscal irá procurar no banco do cliente por uma<br>procedure chamada CORRETORFISCAL_PRODUTOS que ficará encarregada de devolver dados<br>básicos dos produtos cadastrados.<br>A procedure receberá alguns parâmetros vindos do corretor fiscal e por sua vez também enviará<br>dados.</p>
<h3 id="Parametros-de-entrada"><a href="#Parametros-de-entrada" class="headerlink" title="Parâmetros de entrada"></a>Parâmetros de entrada</h3><p>O corretor enviará alguns dados ao chamar essa procedure, são eles:</p>
<p><strong>IDCLIENTE</strong> - O ID de cadastro do cliente no Acerto Fiscal. Tipo: VARCHAR(20)</p>
<p><strong>QTDEREGISTROS</strong> - Usada de forma interna pelo corretor para divisão de carga de envio.Tipo: INTEGER</p>
<p><strong>SKIPREGISTROS</strong> - Usada de forma interna pelo corretor para definir intervalos de execução.Tipo: INTEGER</p>
<p><strong>TODOS</strong> - Sinaliza se a procedure deve executar enviar TODOS os dados presentes no banco<br>ou apenas os que ainda não foram corrigidos. Tipo: CHAR(1)</p>
<h3 id="O-que-a-procedure-deve-fazer"><a href="#O-que-a-procedure-deve-fazer" class="headerlink" title="O que a procedure deve fazer ?"></a>O que a procedure deve fazer ?</h3><p>Quando receber o parâmetro de entrada TODOS como valor T a procedure deve enviar TODOS os<br>produtos presentes no banco do cliente. Quando a procedure receber o parâmetro de entrada<br>TODOS com valor diferente de T a mesma deve enviar apenas os produtos que ainda não foram<br>corrigidos.</p>
<p>Fica a cargo da Software House a criação de um campo para a sinalização se o produto foi<br>corrigido ou não pelo Corretor Fiscal. No caso da Tetra Soluções o campo a ser usado é o<br>FLAGTRIBUT.</p>
<h3 id="Exemplo-procedure-CORRETORFISCAL-PRODUTOS"><a href="#Exemplo-procedure-CORRETORFISCAL-PRODUTOS" class="headerlink" title="Exemplo procedure CORRETORFISCAL_PRODUTOS:"></a>Exemplo procedure CORRETORFISCAL_PRODUTOS:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> dbo.CORRETORFISCAL_PRODUTOS (@IDCLIENTE <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">@QTDEREGISTROS <span class="built_in">INTEGER</span>,@SKIPREGISTROS <span class="built_in">INTEGER</span>,@TODOS <span class="built_in">CHAR</span>(<span class="number">1</span>) = <span class="string">'F'</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> @TODOS = <span class="string">'T'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">MAX</span>(e.CODIGO) <span class="keyword">AS</span> CODIGOINTERNO,<span class="keyword">MAX</span>(e.NOME) <span class="keyword">AS</span> DESCRICAO, <span class="keyword">MAX</span>(e1.EAN) <span class="keyword">AS</span> EAN,<span class="keyword">MAX</span>(e.CODNCM) <span class="keyword">AS</span> CODIGONCM, <span class="keyword">MAX</span>(e.CODCEST) <span class="keyword">AS</span> CODIGOCEST,</span><br><span class="line">  <span class="keyword">MAX</span>(p.SAIDA) <span class="keyword">AS</span> CSTPISSAIDA, <span class="keyword">MAX</span>(p.ALIQPIS) <span class="keyword">AS</span> ALIQPISSAIDA, <span class="keyword">MAX</span>(p.SAIDA) <span class="keyword">AS</span> CSTCOFINSSAIDA, <span class="keyword">MAX</span>(p.ALIQCOFINS) <span class="keyword">AS</span> ALIQCOFINSSAIDA,</span><br><span class="line">  <span class="keyword">MAX</span>(<span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> (a.REDUCAOBASECALCULO <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">OR</span> a.REDUCAOBASECALCULO &lt;= <span class="number">0</span>) <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'0'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> a.REDUCAOBASECALCULO &gt; <span class="number">0</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'20'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'F'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'60'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'I'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'40'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'N'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'41'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">END</span>) <span class="keyword">AS</span> CSTICMSSAIDA,</span><br><span class="line">  <span class="keyword">MAX</span>(a.VALOR) <span class="keyword">AS</span> ALIQICMSSAIDA, <span class="keyword">MAX</span>(a.ALIQ_FCP) <span class="keyword">AS</span> FCP_ALIQUOTA,</span><br><span class="line">  <span class="keyword">MAX</span>(<span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> (a.REDUCAOBASECALCULO <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">OR</span> a.REDUCAOBASECALCULO &lt;= <span class="number">0</span>) <span class="keyword">THEN</span> <span class="string">'102'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> a.REDUCAOBASECALCULO &gt; <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">'102'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'F'</span> <span class="keyword">THEN</span> <span class="string">'500'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'I'</span> <span class="keyword">THEN</span> <span class="string">'300'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'N'</span> <span class="keyword">THEN</span> <span class="string">'400'</span></span><br><span class="line">  <span class="keyword">END</span>) <span class="keyword">AS</span> CSOSN</span><br><span class="line">  <span class="keyword">FROM</span> ESTOQUE e</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ESTCOD e1 <span class="keyword">ON</span> e.CODIGO = e1.CODIGO <span class="keyword">AND</span> e1.EAN <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'F%'</span> <span class="keyword">AND</span> <span class="keyword">LEN</span>(e1.EAN) &gt; <span class="number">7</span></span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> PISCOF p <span class="keyword">ON</span> e.PISCOF = p.CODIGO</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ALIQUOTA a <span class="keyword">ON</span> e.ALIQUOTA = a.CODIGO</span><br><span class="line">  <span class="keyword">WHERE</span> e.SITUACAO = <span class="string">'A'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.CODIGO;</span><br><span class="line"></span><br><span class="line">ELSE</span><br><span class="line"></span><br><span class="line"> <span class="keyword">SELECT</span> <span class="keyword">MAX</span>(e.CODIGO) <span class="keyword">AS</span> CODIGOINTERNO,<span class="keyword">MAX</span>(e.NOME) <span class="keyword">AS</span> DESCRICAO, <span class="keyword">MAX</span>(e1.EAN) <span class="keyword">AS</span> EAN, <span class="keyword">MAX</span>(e.CODNCM) <span class="keyword">AS</span> CODIGONCM, <span class="keyword">MAX</span>(e.CODCEST) <span class="keyword">AS</span> CODIGOCEST,</span><br><span class="line"> <span class="keyword">MAX</span>(p.SAIDA) <span class="keyword">AS</span> CSTPISSAIDA, <span class="keyword">MAX</span>(p.ALIQPIS) <span class="keyword">AS</span> ALIQPISSAIDA,<span class="keyword">MAX</span>(p.SAIDA) <span class="keyword">AS</span> CSTCOFINSSAIDA, <span class="keyword">MAX</span>(p.ALIQCOFINS) <span class="keyword">AS</span> ALIQCOFINSSAIDA,</span><br><span class="line"> <span class="keyword">MAX</span>(<span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> (a.REDUCAOBASECALCULO <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">OR</span> a.REDUCAOBASECALCULO &lt;= <span class="number">0</span>) <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'0'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> a.REDUCAOBASECALCULO &gt; <span class="number">0</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'20'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'F'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'60'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'I'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'40'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'N'</span> <span class="keyword">THEN</span> <span class="keyword">RIGHT</span>( <span class="string">'0'</span> + <span class="keyword">convert</span>(<span class="built_in">varchar</span>(<span class="number">2</span>), <span class="string">'41'</span>), <span class="number">2</span> )</span><br><span class="line">  <span class="keyword">END</span>) <span class="keyword">AS</span> CSTICMSSAIDA,</span><br><span class="line">  <span class="keyword">MAX</span>(a.VALOR) <span class="keyword">AS</span> ALIQICMSSAIDA, <span class="keyword">MAX</span>(a.ALIQ_FCP) <span class="keyword">AS</span> FCP_ALIQUOTA,</span><br><span class="line">  <span class="keyword">MAX</span>(<span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> (a.REDUCAOBASECALCULO <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">OR</span> a.REDUCAOBASECALCULO &lt;= <span class="number">0</span>) <span class="keyword">THEN</span> <span class="string">'102'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'T'</span> <span class="keyword">AND</span> a.REDUCAOBASECALCULO &gt; <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">'102'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'F'</span> <span class="keyword">THEN</span> <span class="string">'500'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'I'</span> <span class="keyword">THEN</span> <span class="string">'300'</span></span><br><span class="line">  <span class="keyword">WHEN</span> e.ICMS_SAI = <span class="string">'N'</span> <span class="keyword">THEN</span> <span class="string">'400'</span></span><br><span class="line">  <span class="keyword">END</span>) <span class="keyword">AS</span> CSOSN</span><br><span class="line">  <span class="keyword">FROM</span> ESTOQUE e</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ESTCOD e1 <span class="keyword">ON</span> e.CODIGO = e1.CODIGO <span class="keyword">AND</span> e1.EAN <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'F%'</span> <span class="keyword">AND</span> <span class="keyword">LEN</span>(e1.EAN) &gt; <span class="number">7</span></span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> PISCOF p <span class="keyword">ON</span> e.PISCOF = p.CODIGO</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ALIQUOTA a <span class="keyword">ON</span> e.ALIQUOTA = a.CODIGO</span><br><span class="line">  <span class="keyword">WHERE</span> e.SITUACAO = <span class="string">'A'</span> <span class="keyword">AND</span>  e.FLAGSEMREVISAO &lt;&gt; <span class="string">'1'</span> <span class="keyword">AND</span> e.FLAGTRIBUT &lt;&gt; <span class="string">'T'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.CODIGO;</span><br><span class="line"></span><br><span class="line">RETURN</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>Esse exemplo demonstra o corpo inicial de uma procedure CORRETORFISCAL_PRODUTOS. Nele<br>pode ser visto os parâmetros de entrada e saída sendo aplicados. Fica a cargo da Sotware House<br>empregar a lógica de coleta dos parâmetros.</p>
<p>Recebendo dados corrigidos do acerto - <strong>CORRIGIR_TRIBUTACAO</strong></p>
<p>O Corretor fiscal fará uso da procedure descrita acima para enviar os dados para o banco de<br>dados do acerto que por sua vez retornará os dados tributários corrigidos. A procedure<br>encarregada de persistir os dados corrigidos pelo acerto no banco de dados do cliente é a<br><strong>CORRIGIR_TRIBUTACAO</strong>.</p>
<p>Assim como a <strong>CORRETORFISCAL_PRODUTOS</strong> a <strong>CORRIGIR_TRIBUTACAO</strong> também recebe dados de<br>entrada e saída.</p>
<p><strong>Parâmetros de entrada</strong></p>
<p>O corretor devolverá os dados tributários corrigidos referente a cada produto no banco do<br>cliente, são eles:</p>
<p><strong>IDCLIENTE</strong> - O ID de cadastro do cliente no Acerto Fiscal. Tipo:<br>ARCHAR(20)</p>
<p><strong>CODIGOPRODUTO</strong> - Código interno do produto, podendo ser a chave primária do mesmo ou<br>quaisquer outras colunas usadas como identificadores únicos com exceção do EAN. Tipo: VARCHAR(100)</p>
<p><strong>CODIGOEAN</strong> - Código EAN. Tipo: VARCHAR(14)</p>
<p><strong>NCM</strong> - Nomenclatura Comum do Mercosul. Tipo: VARCHAR(14)</p>
<p><strong>NCM_EX</strong> -</p>
<p><strong>CEST</strong> - Código Especificador da Substituição Tributária Corrigido Tipo: VARCHAR(10)</p>
<p><strong>CODIGOSEGMENTO</strong> - A tributação está organizada em segmentos dentro do banco do<br>acerto. Esse dado é retornado caso seja necessário criar algum tipo de distinção tributária<br>baseada em dados fornecidos pelo acerto. Tipo: INTEGER</p>
<p><strong>NOMESEGMENTO</strong> - Nome do segmento, veja atributo acima Tipo: VARCHAR(200)</p>
<p><strong>DESCRICAONCM</strong> - Descrição corrigida do NCM, pode ser usado para corrigir a tributação<br>existente do NCM. Tipo: VARCHAR(200)</p>
<p><strong>ICMS_ALIQUOTA</strong> - Alíquota de ICMS corrigida. Tipo: DOUBLE</p>
<p><strong>ICMS_CST</strong> - Código de Substituição Tributária do ICMS. Tipo: CHAR(2)</p>
<p><strong>ICMS_ORIGEM_CST</strong> - Código de Substituição Tributária de Origem do ICMS. Tipo: CHAR(3)</p>
<p><strong>ICMS_REDUCAOBASE</strong> - Redução base do ICMS. Tipo: DOUBLE</p>
<p><strong>CSOSN</strong> - Código de Situação da Operação do Simples Nacional corrigido. Tipo: INTEGER</p>
<p><strong>ORIGEM</strong> - Código de Origem. Tipo: CHAR(1)</p>
<p><strong>IPI_CST</strong> - Código de Substituição Tributária do IPI corrigido. Tipo: VARCHAR(2)</p>
<p><strong>IPI_ALIQUOTA</strong> - Alíquota IPI corrigida. Tipo: DOUBLE</p>
<p><strong>CFOP</strong> - Código Fiscal de Operações e Prestações. Tipo: CHAR(4)</p>
<p><strong>PIS_CST</strong> - Código de Substituição Tributária do PIS corrigido. Tipo: CHAR(2)</p>
<p><strong>PIS_ALIQUOTA</strong> - Alíquota do PIS corrigida. Tipo: DOUBLE</p>
<p><strong>COFINS_CST</strong> - Código de Substituição Tributária do COFINS corrigido. Tipo: CHAR(2)</p>
<p><strong>COFINS_ALIQUOTA</strong> - Alíquota COFINS corrigida. Tipo: DOUBLE</p>
<p><strong>NATUREZARECEITA</strong> - Natureza da receita. Tipo: VARCHAR(3)</p>
<p><strong>ICMS_SITUACAOTRIBUTARIA</strong> - ICMS de substituição tributária corrigido. Caso não precise ser<br>corrigido, pode ser definido como um varchar vazio Tipo: VARCHAR(50)</p>
<p><strong>FCP_ALIQUOTA</strong> - Alíquota do Fundo de combate a pobreza corrigida. Caso não precise ser<br>corrigido pode ser definido um valor padrão. Tipo: DOUBLE</p>
<p><strong>DESONERACAO</strong> - Campo informando se o produto tem desoneração ou não. Caso não exista<br>aceita valor padrão ‘F’. Tipo: CHAR(1)</p>
<p><strong>MOTIVODESONERACAO</strong> - Motivo da desoneração corrigido. Aceita campo padrão. Tipo: CHAR(1)</p>
<p><strong>ALIQUOTADESONERACAO</strong> - Alíquota desoneração corrigida. Aceita campo padrão. Tipo: CHAR(1)<br>CODIGOBENEFICIO - Código benefício corrigido.</p>
<p><strong>Parâmetros de retorno</strong></p>
<p>A procedure por sua vez retornará um status para o Acerto Fiscal para que o mesmo analise<br>dados sobre a correção. É encorajado o uso de transações e blocos try catch . Os campos de<br>retorno podem ser usados para fornecer informações úteis a cerca de possíveis erros de<br>execução ou informar o processamento correto da procedure</p>
<p><strong>STATUS</strong> - Um código de status definido pelos desenvolvedores da procedure, pode ser OK, 200,<br>500 de acordo com o tipo de retorno da procedure</p>
<p><strong>MENSAGEMERRO</strong> - Uma mensagem de erro ou de status</p>
<p>Obs.: No caso do campo STATUS o valor 0 (ZERO) significa que o produto foi corrigido, foi revisado.<br>Qualquer outro valor diferente de 0 (ZERO), significa o produto não foi corrigido.</p>
<p><strong>O que a procedure deve fazer ?</strong></p>
<p>A procedure <strong>CORRIGIR_TRIBUTACAO</strong> recebe os dados corrigidos do banco do Acerto Fiscal e se<br>encarrega de persisti-los no banco do cliente.</p>
<p>Também fica a cargo dessa procedure alimentar o campo FLAGTRIBUT com ‘T’ caso<br>a execução seja bem sucedida (veja o tópico O que a procedure deve fazer ? da procedure<br>CORRETORFISCAL_PRODUTOS). Dessa forma, o corretor terá a habilidade de enviar somente os<br>produtos pendentes de análise em seu fluxo de execução padrão.</p>
<p>Exemplo procedure CORRIGIR_TRIBUTACAO:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dbo.CORRIGIR_TRIBUTACAO (</span><br><span class="line">					@IDCLIENTE <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">					@CODIGOPRODUTO <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">					@CODIGOEAN <span class="built_in">VARCHAR</span>(<span class="number">14</span>),</span><br><span class="line">					@NCM <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">					@NCM_EX <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">					@CEST <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">					@IDSEGMENTO <span class="built_in">INTEGER</span>,</span><br><span class="line">					@NOMESEGMENTO <span class="built_in">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">					@DESCRICAONCM <span class="built_in">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">					@ICMS_ALIQUOTA <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">					@ICMS_CST <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">					@ICMS_ORIGEM_CST <span class="built_in">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">					@ICMS_REDUCAOBASE <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">					@CSOSN <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">					@ORIGEM <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">					@IPI_CST <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">					@IPI_ALIQUOTA <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">					@CFOP <span class="built_in">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">					@PIS_CST <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">					@PIS_ALIQUOTA <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">					@COFINS_CST <span class="built_in">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">					@COFINS_ALIQUOTA <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>,</span><br><span class="line">					@NATUREZARECEITA <span class="built_in">VARCHAR</span>(<span class="number">3</span>),</span><br><span class="line">					@ICMS_SITUACAOTRIBUTARIA <span class="built_in">VARCHAR</span>(<span class="number">50</span>) = <span class="string">''</span>,</span><br><span class="line">					@FCP_ALIQUOTA <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span> = <span class="number">0</span>,</span><br><span class="line">					@DESONERACAO <span class="built_in">CHAR</span>(<span class="number">1</span>) = <span class="string">'F'</span>,</span><br><span class="line">					@MOTIVODESONERACAO <span class="built_in">CHAR</span>(<span class="number">1</span>) = <span class="string">'9'</span>,</span><br><span class="line">					@ALIQUOTADESONERACAO <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span> = <span class="number">0</span>,</span><br><span class="line">					@CODIGOBENEFICIO <span class="built_in">VARCHAR</span>(<span class="number">10</span>) = <span class="string">''</span>,</span><br><span class="line">					@<span class="keyword">STATUS</span> <span class="built_in">INTEGER</span> <span class="keyword">OUTPUT</span>,</span><br><span class="line">					@MENSAGEMERRO <span class="built_in">VARCHAR</span>(<span class="number">400</span>) <span class="keyword">OUTPUT</span></span><br><span class="line"> ) <span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">DECLARE</span> @NOME_PROD <span class="built_in">VARCHAR</span>(<span class="number">40</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> @COD_ALIQUOTA <span class="built_in">NUMERIC</span>(<span class="number">4</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> @COD_ULTREG <span class="built_in">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> @ICMS_SAI <span class="built_in">CHAR</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> @COD_PISCOF <span class="built_in">NUMERIC</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> @MOTIVODESON <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- PEGA O NOME DO PRODUTO CADASTRADO NO BANCO DO CLIENTE</span></span><br><span class="line">    <span class="keyword">SET</span> @NOME_PROD = (<span class="keyword">SELECT</span> e.NOME <span class="keyword">FROM</span> ESTOQUE e <span class="keyword">WHERE</span> e.CODIGO = @CODIGOPRODUTO);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">SET</span> @COD_ALIQUOTA = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> @COD_PISCOF = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> @COD_ULTREG = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">-- VERIFICAÇÃO DA ALIQUOTA - ICMS_SAI</span></span><br><span class="line">    IF NOT EXISTS ( <span class="keyword">SELECT</span> TOP <span class="number">1</span> a.CODIGO <span class="keyword">FROM</span> ALIQUOTA a <span class="keyword">WHERE</span> valor = @ICMS_ALIQUOTA <span class="keyword">AND</span> a.ALIQ_FCP = @FCP_ALIQUOTA <span class="keyword">AND</span> a.REDUCAOBASECALCULO = @ICMS_REDUCAOBASE )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">--select no ultreg campo tabela = 'aliquota' -&gt; codigo</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>  (<span class="keyword">SELECT</span> u.CODIGO <span class="keyword">FROM</span> ULTREG u <span class="keyword">WHERE</span> u.TABELA = <span class="string">'ALIQUOTA'</span>)</span><br><span class="line">          <span class="keyword">BEGIN</span></span><br><span class="line">            <span class="keyword">SET</span> @COD_ULTREG = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">INSERT</span> <span class="keyword">INTO</span> ULTREG (TABELA,CODIGO) <span class="keyword">VALUES</span> (<span class="string">'ALIQUOTA'</span>,@COD_ULTREG);</span><br><span class="line">          <span class="keyword">END</span></span><br><span class="line">        <span class="keyword">ELSE</span></span><br><span class="line">          <span class="keyword">BEGIN</span></span><br><span class="line">            <span class="keyword">SET</span> @COD_ULTREG = (<span class="keyword">SELECT</span> u.CODIGO <span class="keyword">FROM</span> ULTREG u <span class="keyword">WHERE</span> u.TABELA = <span class="string">'ALIQUOTA'</span>);</span><br><span class="line">          <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- insert em aliquota</span></span><br><span class="line">         <span class="keyword">SET</span> @COD_ALIQUOTA = @COD_ULTREG;</span><br><span class="line">         <span class="keyword">INSERT</span> <span class="keyword">INTO</span> ALIQUOTA (CODIGO,VALOR,ESTADO,ALIQ_FCP,REDUCAOBASECALCULO) <span class="keyword">VALUES</span> (@COD_ALIQUOTA,@ICMS_ALIQUOTA,<span class="string">'RJ'</span>,@FCP_ALIQUOTA,@ICMS_REDUCAOBASE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">--update no ultreg</span></span><br><span class="line">        <span class="keyword">UPDATE</span> ULTREG <span class="keyword">SET</span> CODIGO = @COD_ULTREG + <span class="number">1</span> <span class="keyword">WHERE</span> TABELA = <span class="string">'ALIQUOTA'</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">SET</span> @COD_ALIQUOTA =  ( <span class="keyword">SELECT</span> TOP <span class="number">1</span> a.CODIGO <span class="keyword">FROM</span> ALIQUOTA a <span class="keyword">WHERE</span> valor = @ICMS_ALIQUOTA <span class="keyword">AND</span> a.ALIQ_FCP = @FCP_ALIQUOTA <span class="keyword">AND</span> a.REDUCAOBASECALCULO = @ICMS_REDUCAOBASE );</span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- VERIFICAÇÃO DO PISCOF_SAIDA</span></span><br><span class="line">    <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>  (<span class="keyword">SELECT</span> TOP <span class="number">1</span> p.CODIGO <span class="keyword">FROM</span> PISCOF p <span class="keyword">WHERE</span> p.SAIDA = @PIS_CST <span class="keyword">AND</span>  p.ALIQPIS = @PIS_ALIQUOTA <span class="keyword">AND</span> p.ALIQCOFINS = @COFINS_ALIQUOTA )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line">    	  <span class="comment">--select no ultreg campo tabela = 'PISCOF' -&gt; codigo</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> u.CODIGO <span class="keyword">FROM</span> ULTREG u <span class="keyword">WHERE</span> u.TABELA = <span class="string">'PISCOF'</span>)</span><br><span class="line">          <span class="keyword">BEGIN</span></span><br><span class="line">            <span class="keyword">SET</span> @COD_ULTREG = @COD_ULTREG + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">INSERT</span> <span class="keyword">INTO</span> ULTREG (TABELA,CODIGO) <span class="keyword">VALUES</span> (<span class="string">'PISCOF'</span>,@COD_ULTREG);</span><br><span class="line">          <span class="keyword">END</span></span><br><span class="line">        <span class="keyword">ELSE</span></span><br><span class="line">          <span class="keyword">BEGIN</span></span><br><span class="line">            <span class="keyword">SET</span> @COD_ULTREG = (<span class="keyword">SELECT</span> u.CODIGO <span class="keyword">FROM</span> ULTREG u <span class="keyword">WHERE</span> u.TABELA = <span class="string">'PISCOF'</span>);</span><br><span class="line">          <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">-- insert em piscof</span></span><br><span class="line">          <span class="keyword">INSERT</span> <span class="keyword">INTO</span> PISCOF (CODIGO,DESCRICAO,ENTRADA,SAIDA,ALIQPIS,ALIQCOFINS,NAT_REC) <span class="keyword">VALUES</span> (@COD_ULTREG,<span class="string">'OUTROS'</span>,<span class="string">'00'</span>,@PIS_CST,@PIS_ALIQUOTA,@COFINS_ALIQUOTA,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">--update em estoque, campo PISCOF</span></span><br><span class="line">          <span class="keyword">UPDATE</span> ESTOQUE <span class="keyword">SET</span> PISCOF = @COD_ULTREG <span class="keyword">WHERE</span> CODIGO = @CODIGOPRODUTO;</span><br><span class="line"></span><br><span class="line">          <span class="comment">--update no ultreg</span></span><br><span class="line">          <span class="keyword">SET</span> @COD_ULTREG = @COD_ULTREG + <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">UPDATE</span> ULTREG <span class="keyword">SET</span> CODIGO = @COD_ULTREG <span class="keyword">WHERE</span> TABELA = <span class="string">'PISCOF'</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line">          <span class="keyword">SET</span> @COD_PISCOF = (<span class="keyword">SELECT</span> TOP <span class="number">1</span> p.CODIGO <span class="keyword">FROM</span> PISCOF p <span class="keyword">WHERE</span> p.SAIDA = @PIS_CST <span class="keyword">AND</span>  p.ALIQPIS = @PIS_ALIQUOTA <span class="keyword">AND</span> p.ALIQCOFINS = @COFINS_ALIQUOTA );</span><br><span class="line">          <span class="keyword">UPDATE</span> ESTOQUE <span class="keyword">SET</span> PISCOF = @COD_PISCOF <span class="keyword">WHERE</span> CODIGO = @CODIGOPRODUTO;</span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- se @ICMS_CST - 00,20 = T  10,30,60,70 =&gt; 'F' 40 -&gt; I 41 -&gt; N</span></span><br><span class="line">    <span class="keyword">SET</span> @ICMS_SAI = <span class="keyword">CASE</span></span><br><span class="line">      <span class="keyword">WHEN</span> @ICMS_CST <span class="keyword">IN</span> (<span class="string">'00'</span>,<span class="string">'20'</span>) <span class="keyword">THEN</span> <span class="string">'T'</span></span><br><span class="line">      <span class="keyword">WHEN</span> @ICMS_CST <span class="keyword">IN</span> (<span class="string">'10'</span>,<span class="string">'30'</span>,<span class="string">'60'</span>,<span class="string">'70'</span>) <span class="keyword">THEN</span> <span class="string">'F'</span></span><br><span class="line">      <span class="keyword">WHEN</span> @ICMS_CST <span class="keyword">IN</span> (<span class="string">'40'</span>) <span class="keyword">THEN</span> <span class="string">'I'</span></span><br><span class="line">      <span class="keyword">WHEN</span> @ICMS_CST <span class="keyword">IN</span> (<span class="string">'41'</span>) <span class="keyword">THEN</span> <span class="string">'N'</span></span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> @MOTIVODESONERACAO = <span class="string">''</span> <span class="keyword">OR</span> @MOTIVODESONERACAO <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line">    	  <span class="keyword">SET</span> @MOTIVODESON = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">SET</span> @MOTIVODESON = <span class="keyword">CONVERT</span>(<span class="built_in">INT</span>, @MOTIVODESONERACAO);</span><br><span class="line">      <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">BEGIN</span> TRY</span><br><span class="line">      <span class="keyword">UPDATE</span> ESTOQUE <span class="keyword">SET</span></span><br><span class="line">      ALIQUOTA = <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @ICMS_SAI = <span class="string">'I'</span> <span class="keyword">THEN</span> @ALIQUOTADESONERACAO <span class="keyword">ELSE</span> @COD_ALIQUOTA <span class="keyword">END</span>,</span><br><span class="line">      CODNCM = <span class="keyword">LEFT</span>(@NCM,<span class="number">8</span>), ICMS_SAI = @ICMS_SAI, MOTIVODESON = @MOTIVODESON, PISCOF = @COD_PISCOF,</span><br><span class="line">      NATRECPISCOF = <span class="keyword">CONVERT</span>(<span class="built_in">INT</span>,@NATUREZARECEITA), CODCEST = <span class="keyword">LEFT</span>(@CEST,<span class="number">7</span>), CODBENEFICIO =	@CODIGOBENEFICIO,</span><br><span class="line">      FLAGTRIBUT = <span class="string">'T'</span>, DTTRIBUT = <span class="keyword">GETDATE</span>() <span class="keyword">WHERE</span> CODIGO = @CODIGOPRODUTO;</span><br><span class="line">    <span class="keyword">END</span> TRY</span><br><span class="line">      <span class="keyword">BEGIN</span> CATCH</span><br><span class="line">	<span class="keyword">SET</span> @<span class="keyword">STATUS</span> = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">SET</span> @MENSAGEMERRO = ERROR_MESSAGE() + ERROR_LINE();</span><br><span class="line">	RETURN;</span><br><span class="line">     <span class="keyword">END</span> CATCH;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">SET</span> @<span class="keyword">STATUS</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">SET</span> @MENSAGEMERRO = <span class="string">'REVISADO - OK'</span>;</span><br><span class="line"></span><br><span class="line">    RETURN;</span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>

<p>Esse exemplo demonstra o corpo inicial de uma procedure CORRIGIR_TRIBUTACAO. Nele pode<br>ser visto os parâmetros de entrada e saída sendo aplicados. Fica a cargo da Sotware House<br>persistir os dados, tal como a utilização de boas práticas no desenvolvimento da mesma.</p>
<p><strong>Trigger TRG_TributosEstoque_AU</strong></p>
<p>A trigger TRG_TributosEstoque_AU é uma customização específica da empresa Tetra Soluções.<br>O objetivo da trigger TRG_TributosEstoque_AU é verificar se alguns campos da tabela ESTOQUE<br>sofreram alguma alteração.</p>
<p>Exemplo dos campos que podem sofrer alteração no cadastro de produto. Tabela ESTOQUE:</p>
<ul>
<li>ALIQUOTA</li>
<li>CODNCM</li>
<li>ICMS_SAI</li>
<li>MOTIVODESON</li>
<li>PISCOF</li>
<li>NATRECPISCOF</li>
<li>CODCEST</li>
<li>CODBENEFICIO</li>
</ul>
<p>Caso um desses campos sofram alguma alteração, a trigger irá marcar os campos FLAGTRIBUT = ‘F’,<br>DTTRIBUT = null de acordo com o código do produto. Isso significa que o produto em questão está<br>sendo marcado para ser revisado na próxima correção.</p>
<p>Obs.: Caso o campo FLAGSEMREVISAO esteja com valor igual a ‘1’, significa que esse produto não será<br>revisado em momento algum, ou seja, nunca será revisado.</p>
<h3 id="Exemplo-trigger-TRG-TributosEstoque-AU"><a href="#Exemplo-trigger-TRG-TributosEstoque-AU" class="headerlink" title="Exemplo trigger TRG_TributosEstoque_AU:"></a>Exemplo trigger TRG_TributosEstoque_AU:</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> dbo.TRG_TributosEstoque_AU</span><br><span class="line"><span class="keyword">ON</span> ESTOQUE <span class="keyword">AFTER</span> <span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">DECLARE</span> @COD_PROD <span class="built_in">NUMERIC</span>(<span class="number">6</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">DECLARE</span> @AUX_FLAGTIRBUT <span class="built_in">CHAR</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> @COD_PROD = ins.CODIGO <span class="keyword">FROM</span> INSERTED ins;</span><br><span class="line">  <span class="keyword">SELECT</span> @AUX_FLAGTIRBUT = ins.FLAGTRIBUT <span class="keyword">FROM</span> INSERTED ins;</span><br><span class="line"></span><br><span class="line">  IF ((<span class="keyword">UPDATE</span>(ALIQUOTA) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(CODNCM) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(ICMS_SAI) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(MOTIVODESON) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(PISCOF)</span><br><span class="line">    <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(NATRECPISCOF) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(CODCEST) <span class="keyword">OR</span> <span class="keyword">UPDATE</span>(CODBENEFICIO)) <span class="keyword">AND</span> (@AUX_FLAGTIRBUT &lt;&gt; <span class="string">'T'</span>))</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> ESTOQUE <span class="keyword">SET</span> FLAGTRIBUT = <span class="string">'F'</span>, DTTRIBUT = <span class="literal">NULL</span> <span class="keyword">WHERE</span> CODIGO = @COD_PROD;</span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>

<h1 id="Informacoes-para-IMPLANTACAO-E-SUPORTE-EQUIPE-TETRA"><a href="#Informacoes-para-IMPLANTACAO-E-SUPORTE-EQUIPE-TETRA" class="headerlink" title="Informações para IMPLANTAÇÃO E SUPORTE. EQUIPE TETRA"></a>Informações para IMPLANTAÇÃO E SUPORTE. EQUIPE TETRA</h1><p>O procedimento de instalação consiste nesses passos:</p>
<ol>
<li>Criar os procedimentos no cliente:<ol>
<li>procedure <strong>CORRETORFISCAL_PRODUTOS</strong> - essa procedure pega os produtos ATIVOS com o campo <em>flagtribut</em> &lt;&gt; ‘T’ e que não esteja marcados como <em>sem revisão</em> no seu cadastro. Enviam para análise do ACERTO FISCAL;</li>
<li>procedure <strong>CORRIGIR_TRIBUTACAO</strong> - esta procedure é consumida pelo integrador do ACERTO FISCAL para atualizar os produtos revisados.</li>
<li>trigger <strong>TRG_TributosEstoque_AU</strong> - coloca o produto para ser revisado sempre que algum campo de tributação for alterado pelo usuário.</li>
</ol>
</li>
<li>Informar ao CLIENTE e a equipe do ACERTO FISCAL que o banco de dados está pronto para ser integrado.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2021/03/31/Acerto/" data-id="ckmy23soz0002q2i0zoez6yok" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fiscal/">fiscal</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="gestao-software-GestaoSoftware" class="article article-type-gestao-software" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/03/31/GestaoSoftware/" class="article-date">
  <time datetime="2021-03-31T22:04:06.000Z" itemprop="datePublished">2021-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/31/GestaoSoftware/">Gestao de Software - Tetra</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Manual-de-Conduta-na-Gestao-da-Manutencao-do-SG"><a href="#Manual-de-Conduta-na-Gestao-da-Manutencao-do-SG" class="headerlink" title="Manual de Conduta na Gestão da Manutenção do SG"></a>Manual de Conduta na Gestão da Manutenção do SG</h1><h2 id="Organizacao-de-Riscos"><a href="#Organizacao-de-Riscos" class="headerlink" title="Organização de Riscos"></a>Organização de Riscos</h2><p>Toda demanada enviada ao desenvolvimento deve ser classificada com o <strong>RISCO</strong> ao qual se apresenta ao cliente.</p>
<h3 id="Tabela-de-Riscos"><a href="#Tabela-de-Riscos" class="headerlink" title="Tabela de Riscos"></a>Tabela de Riscos</h3><table>
<thead>
<tr>
<th align="center">Risco</th>
<th>Característica</th>
<th>Prazo</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>R1</strong></td>
<td>Itens de EXTREMA URGÊNCIA que resultem em prejuízo financeiro DIRETO ( ou algo de igual importância) ao cliente.</td>
<td><span style="color:red"><strong>EMERGÊNCIA</strong></span> ( SLA 08 hrs )</td>
</tr>
<tr>
<td align="center"><strong>R2</strong></td>
<td>As operações de negócio que ele executa não conseguem ser concluídas, gerando custos indiretos e ineficiências. PS: Risco aumenta ao longo que o prazo estende.</td>
<td><span style="color:orange"><strong>URGENTE</strong></span> ( SLA 03 dias )</td>
</tr>
<tr>
<td align="center"><strong>R3</strong></td>
<td>Seu produto precisa se adaptar às novas necessidade dos seus clientes ou do mercado. Sejam elas relacionadas a oportunidades de negócio, legislação ou revisão de processos de trabalho para ganho de eficiência.</td>
<td><span style="color:yellow"><strong>PROGRAMADO</strong></span> ( Versão/Build TODA SEMANA )</td>
</tr>
<tr>
<td align="center"><strong>R4</strong></td>
<td>Seu produto não evolui ou inova para acompanhar o seu mercado e seus competidores ( menos vendas e maior perda para concorrentes )</td>
<td><span style="color:green"><strong>PROJETOS</strong></span> Versão nova de 15 a 30 dias</td>
</tr>
<tr>
<td align="center"><strong>R5</strong></td>
<td>Deterioração do processo/produto ( Otimização de ambiente de métricas, arquitetura, performance, etc )</td>
<td><span style="color:blue"><strong>MELHORIAS</strong></span> Versão/Processo nova(o) as cada 3 meses</td>
</tr>
</tbody></table>
<h2 id="Funcionamento-dos-Sistemas-de-Trabalhos-que-reagirao-de-acordo-com-a-necessidade-de-resposta-de-cada-risco"><a href="#Funcionamento-dos-Sistemas-de-Trabalhos-que-reagirao-de-acordo-com-a-necessidade-de-resposta-de-cada-risco" class="headerlink" title="Funcionamento dos Sistemas de Trabalhos que reagirão de acordo com a necessidade de resposta de cada risco"></a>Funcionamento dos <em>Sistemas de Trabalhos</em> que reagirão de acordo com a necessidade de resposta de cada risco</h2><hr>
<h1 id="S1-Risco-1-gt-Emergencia-e"><a href="#S1-Risco-1-gt-Emergencia-e" class="headerlink" title="S1 - Risco 1 =&gt; Emergência e"></a>S1 - Risco 1 =&gt; <span style="color:red">Emergência</span> e</h1><h1 id="S2-Risco-2-gt-Urgencia"><a href="#S2-Risco-2-gt-Urgencia" class="headerlink" title="S2 - Risco 2 =&gt; Urgência"></a>S2 - Risco 2 =&gt; <span style="color:orange">Urgência</span></h1><p><strong>A forma de trabalhar será praticamente a mesma. Somente alterando o local de comunicacão e o tempo de resposta.</strong></p>
<h4 id="Notificando"><a href="#Notificando" class="headerlink" title="Notificando"></a>Notificando</h4><ul>
<li>O chamado deve ser solicitado via <strong>DISCORD</strong> exclusivamente no canal  <strong>dev-risco-1-emergencia</strong> ou <strong>dev-risco-2-urgente</strong></li>
<li><strong>NÃO ACEITAREMOS CHAMADOS SEM O ID DO TICKET DO OTRS</strong></li>
</ul>
<h4 id="Agenda"><a href="#Agenda" class="headerlink" title="Agenda"></a>Agenda</h4><ul>
<li>Não haverá data pré-estabelecida para receber esses chamados. Portanto a medida que for sendo recebido será realocado alguém da equipe para buscar resolver.</li>
<li>Toda sexta-feira Carlos e Welmar estarão alinhando pendências dessas demandas.</li>
</ul>
<h4 id="Forma-de-entrega"><a href="#Forma-de-entrega" class="headerlink" title="Forma de entrega"></a>Forma de entrega</h4><p>A medida que o desenvolvimento for resolvendo e uma build for testada e liberada. <strong>IMEDIATAMENTE</strong> o técnico que gerou a demanda será notificado por quem liberou a versão.</p>
<ul>
<li><span style="color:12ff1e"><strong>A ENTREGA SOMENTE SERÁ COMPUTADA COMO RESOLVIDA A MEDIDA QUE O CLIENTE FOR ATUALIZADO COM A CORRECÃO.</strong></span></li>
<li><span style="color:12ff1e"><strong>PORTANTO assim que for entregue ao cliente. Informe no canal do DISCORD correspondente a mensagem “ENTREGUE ticket XXXXXXXXX.”</strong></span>

</li>
</ul>
<hr>
<h1 id="S3-Risco-3-gt-Programada"><a href="#S3-Risco-3-gt-Programada" class="headerlink" title="S3 - Risco 3 =&gt; Programada"></a>S3 - Risco 3 =&gt; <span style="color:yellow">Programada</span></h1><h4 id="Notificando-1"><a href="#Notificando-1" class="headerlink" title="Notificando"></a>Notificando</h4><ul>
<li>O chamado deve ser solicitado via <strong>DISCORD</strong> exclusivamente pelo <strong>@Welmar</strong>, <strong>@Thiago</strong> e <strong>@Marcus</strong> no canal  <strong>dev-risco-3-programada</strong></li>
<li>Como é uma demanda programada, o canal deve ser utilizado para demandas que podem ser incluídas como “quebra” de programacão. Para tal os demais devem aceitar a entrada não-programada de uma nova demanda na semana.</li>
<li><span style="color:12ff1e">POR PADRÃO AS DEMANDAS DEVEM SER ORGANIZADAS PARA SEREM ENVIADAS NAS REUNIÕES TODA SEGUNDA-FEIRA.</span></li>
<li><strong>NÃO ACEITAREMOS CHAMADOS SEM O ID DO TICKET DO OTRS</strong></li>
</ul>
<h4 id="Agenda-Semanal"><a href="#Agenda-Semanal" class="headerlink" title="Agenda ( Semanal )"></a>Agenda ( Semanal )</h4><table>
<thead>
<tr>
<th>Dia</th>
<th>Horário</th>
<th>Objetivo</th>
<th>Pessoas</th>
</tr>
</thead>
<tbody><tr>
<td>segunda</td>
<td>08:30 &gt; 9:30</td>
<td>Organizar as demandas que devem ser feitas durante a semana. Para liberacão de versão.</td>
<td>@welmar - Suporte / @thiago - Implantacão / @marcus - ES / Time de desenvolvimento</td>
</tr>
<tr>
<td>terca</td>
<td>08:30 &gt; 9:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>Time de desenvolvimento</td>
</tr>
<tr>
<td>quarta</td>
<td>08:30 &gt; 9:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>Time de desenvolvimento</td>
</tr>
<tr>
<td>quinta</td>
<td>08:30 &gt; 9:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>Time de desenvolvimento</td>
</tr>
<tr>
<td>sexta</td>
<td>16:00 &gt; 17:00</td>
<td>Feedback e entrega versão.</td>
<td>Time de desenvolvimento</td>
</tr>
</tbody></table>
<h4 id="Forma-de-entrega-1"><a href="#Forma-de-entrega-1" class="headerlink" title="Forma de entrega"></a>Forma de entrega</h4><p>Na sexta o desenvolvimento entregará uma build testada com o que foi feito. É responsabilidade de cada responsável informar o seu time para entrega da solucão aos clientes solicitantes.</p>
<hr>
<h1 id="S4-Risco-4-gt-Projetos"><a href="#S4-Risco-4-gt-Projetos" class="headerlink" title="S4 - Risco 4 =&gt; Projetos"></a>S4 - Risco 4 =&gt; <span style="color:green">Projetos</span></h1><h4 id="Notificando-2"><a href="#Notificando-2" class="headerlink" title="Notificando"></a>Notificando</h4><ul>
<li>O chamado deve ser solicitado via reunião de abertura de projeto, segundo a agenda de trabalho.</li>
<li>Portanto, qualquer novidade para evolucão do produto armazene e coloque no início do SPRINT.</li>
<li><span style="color:12ff1e">POR PADRÃO AS DEMANDAS DEVEM SER ORGANIZADAS PARA SEREM ENVIADAS NAS REUNIÕES TODO INÍCIO DE PLANEJAMENTO.</span></li>
</ul>
<h4 id="Agenda-Mensal"><a href="#Agenda-Mensal" class="headerlink" title="Agenda ( Mensal )"></a>Agenda ( Mensal )</h4><table>
<thead>
<tr>
<th>Dia</th>
<th>Horário</th>
<th>Objetivo</th>
<th>Pessoas</th>
</tr>
</thead>
<tbody><tr>
<td>1a. segunda do mês</td>
<td>10:00 &gt; 12:00</td>
<td>Organizar as demandas que devem ser feitas. Para liberacão de versão.</td>
<td>@welmar - Suporte / @thiago - Implantacão / @marcus - ES / Time de desenvolvimento</td>
</tr>
<tr>
<td>outras segundas</td>
<td>10:00 &gt; 11:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>@carlos / Time de desenvolvimento envolvido no projeto</td>
</tr>
<tr>
<td>demais dias</td>
<td>09:30 &gt; 10:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>Time de desenvolvimento</td>
</tr>
<tr>
<td>última sexta</td>
<td>16:00 &gt; 17:00</td>
<td>Feedback e entrega versão.</td>
<td>@carlos / Time de desenvolvimento envolvido no projeto</td>
</tr>
</tbody></table>
<h4 id="Forma-de-entrega-2"><a href="#Forma-de-entrega-2" class="headerlink" title="Forma de entrega"></a>Forma de entrega</h4><p>Na sexta o desenvolvimento entregará uma build testada com o que foi feito.</p>
<p>O desenvolvedor deve documentar o novo recurso desenvolvido para o melhor conhecimento dos demais setores.</p>
<hr>
<h1 id="S5-Risco-5-gt-Melhorias"><a href="#S5-Risco-5-gt-Melhorias" class="headerlink" title="S5 - Risco 5 =&gt; Melhorias"></a>S5 - Risco 5 =&gt; <span style="color:blue">Melhorias</span></h1><h4 id="Notificando-3"><a href="#Notificando-3" class="headerlink" title="Notificando"></a>Notificando</h4><ul>
<li>O chamado deve ser solicitado via reunião de abertura de SPRINT, segundo a agenda de trabalho.</li>
</ul>
<h4 id="Agenda-Trimestral"><a href="#Agenda-Trimestral" class="headerlink" title="Agenda ( Trimestral )"></a>Agenda ( Trimestral )</h4><table>
<thead>
<tr>
<th>Dia</th>
<th>Horário</th>
<th>Objetivo</th>
<th>Pessoas</th>
</tr>
</thead>
<tbody><tr>
<td>1a. segunda do trimestre</td>
<td>10:00 &gt; 12:00</td>
<td>Avaliacão de demandas baseadas nos problemas encontrados nos outros sistemas de trabalho.</td>
<td>@thiago - Implantacão / @marcus - ES / @willian / Time de desenvolvimento</td>
</tr>
<tr>
<td>a cada 15 dias</td>
<td>11:00 &gt; 12:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>@carlos / Time de desenvolvimento envolvido no projeto</td>
</tr>
<tr>
<td>demais dias</td>
<td>09:30 &gt; 10:00</td>
<td>Comunicacão, colaboracão para atingir objetivos e remover barreiras de entrega.</td>
<td>Time de desenvolvimento</td>
</tr>
<tr>
<td>última sexta</td>
<td>14:00 &gt; 15:00</td>
<td>Feedback e entrega versão.</td>
<td>@carlos / Time de desenvolvimento</td>
</tr>
</tbody></table>
<h4 id="Forma-de-entrega-3"><a href="#Forma-de-entrega-3" class="headerlink" title="Forma de entrega"></a>Forma de entrega</h4><p>Na sexta o desenvolvimento entregará uma build testada com o que foi feito.</p>
<p>O desenvolvedor deve documentar o novo recurso desenvolvido para o melhor conhecimento dos demais setores.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2021/03/31/GestaoSoftware/" data-id="ckmy23sp50006q2i0qnfhgsge" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Audittar" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/24/Audittar/" class="article-date">
  <time datetime="2021-02-24T19:46:43.224Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 align="center">Audittar: Tutorial de integração de serviço manual e automática</h3>

<h2 id="O-que-preciso"><a href="#O-que-preciso" class="headerlink" title="O que preciso?"></a>O que preciso?</h2><ul>
<li>Instalador de serviços (geralmente está no Mega na pasta Serviços/Instalador.msi);</li>
<li>Dados de conexão do servidor do cliente;</li>
<li>id e token do cliente a ser instalado ( representante parceiro irá disponibilizar esses dados).</li>
</ul>
<h2 id="Sobre"><a href="#Sobre" class="headerlink" title="Sobre:"></a>Sobre:</h2><p>A Audittar é uma empresa que revisa tributações de produtos e permite que empresas clientes utilizem os serviços dela para manter os próprios produtos em conformidade.</p>
<p>A integração faz com que clientes que utilizam o sistema da Tetra possam usar esses serviços da Audittar de forma mais fácil, sendo totalmente integrado ao sistema.</p>
<p>Existe a forma automática, que todo dia o integrador consulta os produtos e obtem as atualizações que a Audittar faz de acordo com o tempo. Porém existe a forma manual que o cliente pode fazer dentro do sistema no cadastro do produto e verificar na hora se o produto tem atualização de tributação e ocorre a atualização na hora daquele produto específico.</p>
<h3 id="Configuracao-Servico-Automatico"><a href="#Configuracao-Servico-Automatico" class="headerlink" title="Configuração - Serviço Automático"></a>Configuração - Serviço Automático</h3><p>1 - No serviço automático, execute o instalador no servidor do cliente:</p>
<p><img src="http://you img base url/https://i.imgur.com/MIroVqj.png?e=1617235479&token=your qiniu access key:fa5tvIwqi7mDkrNrf6tw_GdZBwU=" alt></p>
<p>2 - Preencha os campos de acordo com os dados do cliente:</p>
<p><img src="http://you img base url/https://i.imgur.com/cfOXdCM.png?e=1617235479&token=your qiniu access key:Xd1i5kRvWGYtL0FqIOd6VkTNJVY=" alt></p>
<p>3 - Marque a opção ‘Audittar’ informando que utilizará este serviço:</p>
<p><img src="http://you img base url/https://i.imgur.com/al9bsAz.png?e=1617235479&token=your qiniu access key:JArUQjgL4djd1MQ9donoEeyDjkA=" alt></p>
<p>4 - Finalize a instalação. Após isso vá no caminho da instalação:<br>    Geralmente: (C:\Program Files (x86)\Tetra Solucoes\ServicosTetra)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Abra o arquivo 'ConfigTetra'</span></span><br><span class="line"><span class="comment"># Nele tem vários campos, mas precisaremos colocar os dados em 3 campos:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"IdClientAudittar"</span>: <span class="string">"371"</span>,</span><br><span class="line"><span class="string">"TokenAudittar"</span>: <span class="string">"8d549efd328d8acaf01ff923246ce612"</span>,</span><br><span class="line"><span class="string">"HoraInicioServicoAudittar"</span>: 10,</span><br><span class="line"></span><br><span class="line"><span class="comment"># O id e token será passado pela Audittar, o campo HoraInicioServicoAudittar</span></span><br><span class="line"><span class="comment"># é o horário que o serviço irá iniciar automaticamente.</span></span><br><span class="line"><span class="comment"># Se estiver configurado para 20 horas, ele vai executar entre 20 e 21 horas.</span></span><br><span class="line"><span class="comment"># obs.(Por padrão ele vem com 22).</span></span><br></pre></td></tr></table></figure>

<p>O serviço todo dia irá pegar todos os produtos da base de dados local do cliente e enviando para a Audittar. Se caso já tiver sido revisado o produto ele retorna a tributação e atualiza a base, se não no próximo dia ele busca de novo até ser revisado.</p>
<p>Após a revisão do produto, na tabela ESTOQUE do banco o serviço marca o campo FLAGTRIBUT com a letra ‘R’, se não revisar o campo fica vazio.</p>
<h3 id="Configuracao-Manual"><a href="#Configuracao-Manual" class="headerlink" title="Configuração - Manual"></a>Configuração - Manual</h3><p>Para configurar manualmente, abra o sistema em configurações, aba Outros/Pág. 2, selecione Integração Fiscal a opção 4 e preencha os campos cód. Cliente, token e URL:</p>
<p><img src="http://you img base url/https://i.imgur.com/husrgFy.png?e=1617235479&token=your qiniu access key:Umg7k5ocq-VwbVQX6a1ZEqXredI=" alt></p>
<p>url: <a href="http://api.audittar.com.br/webservice/ConsultaJSON" target="_blank" rel="noopener">http://api.audittar.com.br/webservice/ConsultaJSON</a></p>
<p>Após Salvar e reiniciar o sistema é só ir no cadastro do produto, selecionar algum produto e clicar no ícone de busca de atualização do serviço:</p>
<p><img src="http://you img base url/https://i.imgur.com/wbEk2cU.png?e=1617235479&token=your qiniu access key:MofIm3Gz7n7Fibi-6YQzqhotS60=" alt></p>
<p>obs.(Se caso não atualizar a tributação é porque foi enviado e a Audittar ainda não revisou esse produto.)</p>
<h2 id="Licenca"><a href="#Licenca" class="headerlink" title="Licença"></a>Licença</h2><p>Esse projeto é licenciado pela Tetra Soluções Empresariais.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2021/02/24/Audittar/" data-id="ckmy23sp20004q2i0u1rc86xb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Scantech" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/19/Scantech/" class="article-date">
  <time datetime="2021-02-19T14:35:39.000Z" itemprop="datePublished">2021-02-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/19/Scantech/">SCANTECH</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-Funcao"><a href="#1-Funcao" class="headerlink" title="1. Função"></a>1. Função</h3><p>Integração com a empresa Scantech que organiza promoções e a loja recebe reembolso(cashback) pelas vendas.</p>
<p>Utilitários &gt; Configurações &gt; Filiais na aba ‘Adicionais’</p>
<h3 id="2-Configuracao"><a href="#2-Configuracao" class="headerlink" title="2. Configuração"></a>2. Configuração</h3><ul>
<li>Primeiramente o cliente deve ter o contrato firmado diretamente com o Scantech, onde ele vai receber os dados para possibilitar a integração;</li>
<li>Pegue os dados do cliente na Scantech, você encontrá-lo no FAQ ou solicitando ao suporte, caso a etapa anterior já tenha sido feita;</li>
<li>Instale o serviço e na tela de config preencha<br>  a. Na tela geral os dados de acesso ao banco de dados Server, Password e Database.<br>  b. Abra a aba ‘Scantech’ e preencha todos os campos <code>ID (5 dígitos)</code>, <code>Username</code> e <code>Password</code> que a Scantech passou do cliente.<br>  c. Preencha também o campo <code>Data</code> no formato <code>MÊS/DIA/ANO</code>, exemplo <code>02/26/2021</code>. Essa data define de quando o scantech começará a puxar as vendas, recomendo que coloque no máximo há 7 dias atrás. Ou seja, se hoje é dia 20 de fevereiro de 2021, coloque <code>02/13/2021</code>.<br>  d. No SG, acesse <code>Utilitários &gt; Configurações &gt; Filiais</code> na aba ‘Adicionais’ coloque o ID_Scantech (1 dígito) para cada Filial que vai fazer parte do serviço.</li>
<li>Salve tudo e reinicie o serviço. Você pode acompanhar os passos do Serviço pelo LOG (no banco fica na tabela <code>SYS_LOGSERVICE</code>).</li>
<li>Se alguma informação estiver faltando, o serviço geral continuará rodando, mas o Scantech vai ficar parado (isso será informado no LOG).</li>
</ul>
<h3 id="3-Etapas-do-servico"><a href="#3-Etapas-do-servico" class="headerlink" title="3. Etapas do serviço"></a>3. Etapas do serviço</h3><ul>
<li>Para cada filial cadastrada o serviço vai rodar 5 rotinas, 1 vez logo ao iniciar e depois de 30 em 30 minutos.</li>
<li>Rotina 1: ele consulta as promoções que estão no Scantech e aplica nos produtos;</li>
<li>Rotina 2: recupera no banco de dados as vendas autorizadas relacionadas com essas promoções e envia para o Scantech;</li>
<li>Rotina 3: recupera no banco de dados as vendas canceladas relacionadas com essas promoções e envia para o Scantech;</li>
<li>Rotina 4: recupera os fechamentos separados por caixa e envia ao scantech</li>
<li>Rotina 5: verifica se a Scantech solicitou algum reenvio de venda ou fechamento e envia</li>
</ul>
<ul>
<li>No logs você pode encontrar esse formato “R2F1: Erro ao enviar venda”, o código <code>R2F1</code> siginifica <code>Rotina 2 Filial 1</code> ou <code>ER5F2</code> que significa <code>Erro Rotina 5 Filial 2</code>, etc.</li>
<li>Avalie o log do inicio até aparecer “Fim das rotinas”, veja se há algum erro ou se alguma venda ou fechamento não foi enviado, se estiver OK, pode dar como concluido.</li>
</ul>
<h3 id="4-Atualizando-ou-trocando-o-Config"><a href="#4-Atualizando-ou-trocando-o-Config" class="headerlink" title="4. Atualizando ou trocando o Config"></a>4. Atualizando ou trocando o Config</h3><ul>
<li>Para trocar informações basta abrir o config na pasta de instalação no .exe <code>TelaConfig</code>. Troque as informações, salve e reinicie o serviço.</li>
<li>Você tambem pode trocar o arquivo <code>ConfigTetra.txt</code> e reiniciar, porém tome cuidado ao trocar por uma versão muito antiga e estar faltando alguns campos, isso pode gerar alguns conflitos.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2021/02/19/Scantech/" data-id="ckmy23sp9000cq2i0vhlb00j7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Clubiz" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/03/Clubiz/" class="article-date">
  <time datetime="2020-11-03T14:30:39.000Z" itemprop="datePublished">2020-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/03/Clubiz/">CLUBIZ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ClubeBiz-integracao-com-os-produtos-da-Hendel"><a href="#ClubeBiz-integracao-com-os-produtos-da-Hendel" class="headerlink" title="ClubeBiz: integração com os produtos da Hendel"></a>ClubeBiz: integração com os produtos da Hendel</h1><p>
Esta integração tem o propósito de manter atualizados os produtos e cadastrar pedidos recebidos pelas plataformas desenvolvidas pela empresa Hendel: o site em Magento e o aplicativo Clube Biz.
</p>

<h2 id="Instalacao"><a href="#Instalacao" class="headerlink" title="Instalação"></a>Instalação</h2><p>
A instalação é realizada do mesmo modo como as outras. 
Os campos <b>obrigatórios</b> são:
<br>
- Na área geral: Filial, DavOpPadrao, Database e Server
<br>
- Na aba 'ClubeBiz': UrlClubeBiz e AccessTokenClubeBiz.
Os campos FilialPedido e FilialEstoque são opcionais, se não forem preenchidos será usado a filial cadastrada em Filial, na área geral.
<i>FilialPedido</i> é onde os pedidos vindo da loja online será cadastrados, <i>FilialEstoque</i> é a filial que será considerada ao atualizar a quantidade do produto no estoque (se a opção <i>SomarEstoqueFilais</i> estiver marcada, essa filial é ignorada).
</p>

<h2 id="Rotina"><a href="#Rotina" class="headerlink" title="Rotina"></a>Rotina</h2><p>
A rotina é composta por 4 etapas
</p>
<ol>
<li><b>Atualização dos produtos recentemente alterados: </b>a função busca os produtos que foram alterados nos últimos 10 minutos. A função considera o campos <i>DATA</i> da tabela <i>ESTOQUE</i>. Essa rotina é chamada a cada 5 minutos. Se o produto estiver em promoção, isso também será informado</li>
<li><b>Novos pedidos: </b>essa função verifica no sistema da Hendel se há algum novo pedido pendente de cadastro. O pedido que a função procura é um que esteja com o status <i>paga_ps (PAGO)</i> e que já não tenha sido cadastrado no banco de dados. O pedido é salvo na tabela <i>DAVPRE</i> com o CODFIL definido em <i>FilialPedido</i> (ou <i>Filial</i> caso aquela não tenha sido preenchida).Essa função é chamada a cada 5 minutos</li>
<li><b>Status do pedido: </b>acompanha o status do pedido e informa a API para que o cliente saiba em que estado está o pedido que foi feito. A atualização é feita a cada 5 minutos.</li>
<li><b>Cadastro e atualização geral: </b>aqui os produtos, independentes de quando foram alterados, são enviados para a integração. A função procura produtos que esteja ativos (A) e marcados para serem enviados para o site online (PRODWEB). Essa função é chamada a cada 2 horas. Se o produto estiver em promoção, isso também será informado</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/11/03/Clubiz/" data-id="ckmy23sp40005q2i08h6zrs6c" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-instabuy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/03/instabuy/" class="article-date">
  <time datetime="2020-11-03T14:30:39.000Z" itemprop="datePublished">2020-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/03/instabuy/">INSTABUY</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-Funcao"><a href="#1-Funcao" class="headerlink" title="1. Função"></a>1. Função</h3><p>Integrar SG com a loja online do Instabuy</p>
<h3 id="2-Onde-consigo-o-instalador"><a href="#2-Onde-consigo-o-instalador" class="headerlink" title="2. Onde consigo o instalador"></a>2. Onde consigo o instalador</h3><p>Instalador padrão dos InstaladorServico_v[versão].msi que fica na pasta Servicos no Mega.</p>
<h3 id="3-Instalacao"><a href="#3-Instalacao" class="headerlink" title="3. Instalação"></a>3. Instalação</h3><p>Rode o instalador e preencha o campo do nome do banco de dados. Caso seja uma reinstalação e já exista uma config, o instalador usará as informações já presentes, trocando apenas o nome do banco.</p>

<p>Os **dados obrigatórios** são:</p>
<ul>
<li>CNPJ (igual do contrato);</li>
<li>Nome Fantasia; (campo livre);</li>
<li>Banco de dados(local);</li>
<li>Server(local);</li>
<li>Filial;</li>
<li>InstaBuyToken(recebido no contrato) e;</li>
<li>Ativar Instabuy na tela de config.</li>
</ul>

<p>
Dados opcionais
</p>
<ul>
<li>Vendedor Padrão</li>
<li>Plano de Venda Padrão</li>
<li>Custo por filial: quando o preço do produto é diferente entre as filiais</li>
<li>Cliente recebe endereço da entrega: sempre que o cliente fizer um pedido, seu endereço será atualizado com o endereço da entrega.</li>
<li>SomarEstoqueFiliais (para as lojas que querem juntar estoque entre as filiais);</li>
</ul>

<p>Todos os campos podem ser alterados a qualquer momento, bastando abrir a tela de config, salvar e reiniciar o serviço no Gerenciador de Serviços do Windows</p>

<p>Para <b>testar</b> o serviço você pode usar livremente a loja de testes da Tetra. Use os dados abaixo (dados da loja de teste da Tetra):</p>
<ul>
<li>CNPJ: `12.048.636/0001-92`</li>
<li>Token: `VO095fPuDB_dp7JxMKzpIlQ7H_TQ31GP24uhfNvBPoY`</li>
</ul>

<h3 id="4-Funcionamento-Rotina"><a href="#4-Funcionamento-Rotina" class="headerlink" title="4. Funcionamento/Rotina"></a>4. Funcionamento/Rotina</h3><p>O serviço inicia logo após a instalação e é composto por 3 rotinas que rodam o dia todo. O contrato com o Instabuy é feito diretamente com o Instabuy (e portanto o pagamento) e no contrato ele vai receber o `Token`.</p>

<p>No início a empresa do Instabuy cadastrará os primeiros produtos, então será pedido um .CSV com as colunas: 'plu' que é o código do produto, 'nome' e 'codbarras'. Para teste é possível cadastrar o produto manualmente no Admin da loja.</p>
<ul>
<li>Link do Admin da loja: `https://admin.instabuy.com.br/access/login`</li>
<li>Link da loja: `https://tetrasolucoes.instabuy.com.br/`</li>
<li>Credenciais Admin: Login: falecom@tetrasolucoes.com.br | Senha: SYSsup007</li>
</ul>

<p><b>ATUALIZAÇÃO E CADASTRO DE PRODUTO</b><br>A função principal da integração é manter atualizado o preço, quantidade de estoque e promoções do produto já cadastrados na plataforma. O serviço vai atualizar preços e quantidade de estoque (somente os produtos com <strong>situação ‘A’ e marcador para Web (prodweb)</strong>), se tiver promoção também será cadastrada caso esteja dentro do prazo de validade desta.<br>O instabuy só identifica promoções de desconto simples, outros tipos de <strong>promoção</strong> como compre 3 leve 4 ou algo o tipo não serão cadastradas.<br>As alterações de preço serão atualizadas a cada <strong>4 minutos,</strong> qualquer outro tipo de alteração será atualizada a cada <strong>1 hora</strong>.<br>O <strong>nome</strong> do produto não será atualizado pela API devido as regras do Instabuy.<br>No caso de produtos que não estejam cadastrados previamente na plataforma, o serviço vai enviar e ele será cadastrados como <strong>INATIVO</strong> e sem foto.<br>Se o produto foi desmarcado para loja ou inativado no sistema, ele será inativado no Instabuy.</p>
<p><b>RECEBIMENTO DE PEDIDOS</b><br>Quando o cliente fizer um pedido, o administrador deve avaliar o pedido pelo aplicativo <strong>Coletor</strong> do Instabuy ou alterar o status para ‘<code>PRODUTOS SEPARADOS</code>‘ pelo Admin (que é o que o Coletor faz por baixo dos panos). Ao alterar o status, o serviço instalado no servidor vai identificá-lo e salvá-lo como pré venda. <code>Muito importante, o serviço só identifica pedidos que estiverem com o status PRODUTOS SEPARADOS</code>.<br>O serviço pesquisa o cliente pelo CPF, e caso não for encontrado, este será cadastrado na base.<br>O endereço de entrega, se for o caso, será colocado na observação do pedido e na tabela <strong>ENTREGA</strong>.<br>Depois que o pedido já foi cadastrado, o serviço vai enviar cada troca de status, até finalizar.</p>
<p>Sobre o <strong>DAVPRE</strong>, o código segue o ULTREG de DAVPRE, CODOFF segue o ULTREG de DAV e toda vez que é cadastrado um DAVPRE ou CLIENTE, o ULTREG é atualizado.</p>
<p><b>LOG</b><br>O serviço gera LOGS no banco de dados na tabela SYS_LOGSERVICE. Use para saber se o serviço correto foi ativado, se houve algum erro, a quantidade de produtos enviados, pedidos cadastrados, etc. Essa tabela é limpa de tempos em tempos.</p>
<h6 id="Resumo-das-Rotinas"><a href="#Resumo-das-Rotinas" class="headerlink" title="Resumo das Rotinas"></a>Resumo das Rotinas</h6><ol>
<li>Pega todos os produtos que estão ativos e marcado pra Web e envia para fazer a atualização. Atualiza preço e estoque.</li>
<li>Verifica se há algum pedido com o status 'Produtos Separados' e salva no banco de dados DAVPRE. Também faz cadastro de Cliente caso não tem no SG.</li>
<li>Verifica se algum pedido mudou de status e informa ao Instabuy.</li>
</ol>

<h3 id="5-Valor-para-o-cliente"><a href="#5-Valor-para-o-cliente" class="headerlink" title="5. Valor para o cliente"></a>5. Valor para o cliente</h3><p>O cliente que contrata o serviço terá um site e um aplicativo próprio da sua loja em sincronia com seu banco de dados.</p>
<h3 id="6-Perguntas-frequentes"><a href="#6-Perguntas-frequentes" class="headerlink" title="6. Perguntas frequentes"></a>6. Perguntas frequentes</h3><ol>
<li>O instabuy tem pagamento online? Não</li>
<li>Como mudar a filial? Basta acessar a pasta onde o serviço foi instalado (Arquivos de Programas > TetraServiços) e abrir TelaConfig</li>
<li>Mudei o nome do produto e não atualizou, é um erro? Não, a API não atualiza nome, são políticas do Instabuy, isso deverá ser feito manualmente.</li>
<li>Qual vendedor vai na pré-venda? Vai o código definido em <i>VendedorPadrao.</i></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/11/03/instabuy/" data-id="ckmy23spc000fq2i04dnix5z2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-AlertaFiscal" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/08/AlertaFiscal/" class="article-date">
  <time datetime="2020-08-08T20:19:02.000Z" itemprop="datePublished">2020-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/08/AlertaFiscal/">Serviço - Alerta Fiscal</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ALERTA-FISCAL"><a href="#ALERTA-FISCAL" class="headerlink" title="ALERTA FISCAL"></a>ALERTA FISCAL</h1><h2 id="Entendendo-o-Servico-Automatico"><a href="#Entendendo-o-Servico-Automatico" class="headerlink" title="Entendendo o Serviço Automático"></a>Entendendo o Serviço Automático</h2><ul>
<li>O serviço terá apenas uma rotina, que será executada uma vez por dia a partir das 22 horas (importante que o servidor do cliente fique ligado para a atualização acontecer).</li>
<li>Ele fará uma busca de todos os produtos que estão disponíveis para atualização, retornando uma lista de códigos. Caso não vier algum produto, é porque a Alerta Fiscal ainda não revisou o produto.</li>
<li>A seguir o serviço buscará na api os dados de cada produto obtido e irá atualizar na base local havendo diferença.</li>
</ul>
<h2 id="Entendendo-o-processo-de-atualizacao-dos-produtos"><a href="#Entendendo-o-processo-de-atualizacao-dos-produtos" class="headerlink" title="Entendendo o processo de atualização dos produtos"></a>Entendendo o processo de atualização dos produtos</h2><ul>
<li>A integração se inicia quando um parceiro do Alerta Fiscal pede os dados dos produtos do cliente. Nessa primeira etapa terá que ser emitido um relatório para envio ao parceiro que contém todos os produtos do cliente com suas tributações exigidas pelo mesmo.</li>
<li>Para emitir esse relatório é só acessar o sistema do cliente, ir em Fiscal/Outros/Integração de Tributação Fiscal. irá abrir uma tela, é só clicar no botão ‘Gerar arquivo para análise’. Será gerado um arquivo a ser enviado ao parceiro. (Para ser gerado o arquivo deve seguir antes a configuração manual no sistema. Geralmente o parceiro acessa o cliente todo més e pega esse relatório do cliente, por isso é importante o parceiro saber fazer esse processo).</li>
<li>Após o envio dos produtos, o parceiro irá disponibilizar um id e token do cliente para configuração do serviço, que aí de acordo com a atualização dos produtos o serviço irá pegar e atualizar a base local, ou também a possibilidade de buscar um produto manualmente após fazer a configuração.</li>
</ul>
<h2 id="Requisitos"><a href="#Requisitos" class="headerlink" title="Requisitos"></a>Requisitos</h2><p><strong>Requisitos para instalação:</strong></p>
<ul>
<li>Sistema operacional Windows 10 ou Windows Server 2012 ou superior;</li>
<li>Sincronos SG atualizado a partir da versão 9.14.3;</li>
<li>Arquivo de instalação ‘Instalação_xxx.msi’ que está no mega na pasta SERVIÇOS/Instalador_xxx.</li>
</ul>
<h3 id="Configuracao-Servico-Automatico"><a href="#Configuracao-Servico-Automatico" class="headerlink" title="Configuração - Serviço Automático"></a>Configuração - Serviço Automático</h3><hr>
<ol>
<li>Ao executar o executável irá iniciar o processo de instalação:</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/9sstXp3.png?e=1617235479&token=your qiniu access key:ZzlXSGo6GuXvEj56LaDsmER4cvs=" alt></p>
<ol start="2">
<li>Marcar TODOS e clicar em avançar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/UxtSRtf.jpg?e=1617235479&token=your qiniu access key:SW0XSGuWGj3AS3QngAkbkfXUGSc=" alt></p>
<ol start="3">
<li>Informar dados solicitados: CNPJ do Cliente, Nome Fantasia, Nome da Base de dados e Nome da Máquina onde está instalado o SQL com essa Base;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/cfOXdCM.png?e=1617235479&token=your qiniu access key:Xd1i5kRvWGYtL0FqIOd6VkTNJVY=" alt></p>
<ol start="5">
<li>Marcar o serviço Alerta Fiscal;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/IKB4lc6.png?e=1617235479&token=your qiniu access key:HrwhstC3B-mTOPDjTvxLJl3ssLo=" alt></p>
<ol start="6">
<li>Clicar em Avançar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/xgIM7GT.png?e=1617235479&token=your qiniu access key:VKBW2YwyWH7Xvfou0auNGPCU2EA=" alt></p>
<ol start="7">
<li>Caso acuse o erro da imagem a baixo, Instale o Netframework 4.7.2. Caso não dê erro, Seguir com o processo.</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/D2bkrKd.png?e=1617235479&token=your qiniu access key:P1DehyaneRKkRBTjKyVoD0VQADs=" alt></p>
<ol start="8">
<li>Clicar em Fechar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/jfwZsYL.png?e=1617235479&token=your qiniu access key:GwsKc-JI28VhSpTV0sxc7Ip-yiM=" alt></p>
<ol start="9">
<li>Após isso vá no caminho da instalação:<br>Geralmente: (C:\Program Files (x86)\Tetra Solucoes\ServicosTetra)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Abra o arquivo 'ConfigTetra'</span></span><br><span class="line"><span class="comment"># Nele tem vários campos, mas precisaremos colocar os dados em 2 campos:</span></span><br><span class="line"><span class="comment"># 'IdAlertaFiscal' e 'TokenAlertaFiscal':</span></span><br><span class="line"></span><br><span class="line"><span class="string">"IdAlertaFiscal"</span>: <span class="string">"125"</span>,</span><br><span class="line"><span class="string">"TokenAlertaFiscal"</span>: <span class="string">"17e99704fd6947778fe4b2924991876h"</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment"># Depois de preencher os dados salve e feche o arquivo.</span></span><br></pre></td></tr></table></figure>

<ol start="10">
<li>Reinicie o serviço TETRA SERVIÇOS que está iniciado no Serviço do Windows:<ul>
<li>Abrir o executar em CTRL+R e digitar Services.msc;</li>
</ul>
</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/yel2TSq.png?e=1617235479&token=your qiniu access key:XF-KIFVFcMtrPz9SWv1o9jf0ykQ=" alt></p>
<ol start="11">
<li>Se quiser conferir o log do serviço para verificar se ocorreu algum problema pode ver o relatório no sistema em Cadastros/Estoque/Serviços/Relatório de Log de Serviços;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/7oKHisv.png?e=1617235479&token=your qiniu access key:c-WeOckXNwSnrAbjzFrxsGGHjEY=" alt></p>
<ul>
<li><p>Só pesquisar o perídodo e o serviço a buscar que irá aparecer o log do serviço. (Esses dados são gravados na tabela SYS_LOGSERVICE)</p>
</li>
<li><p>Obs. Caso aparecer algum erro contate o setor de desenvolvimento para verificar.</p>
</li>
</ul>
<h3 id="Configuracao-Consulta-Manual"><a href="#Configuracao-Consulta-Manual" class="headerlink" title="Configuração - Consulta Manual"></a>Configuração - Consulta Manual</h3><ol>
<li>Abrir o SG, ir em Utilitários - Configuração - Sistema - Outros, verificar se a opção de integração Fiscal - ComoTributar está marcada e preencher os campos Cód. Cliente, token e url do serviço:</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/zNRVl0o.png?e=1617235479&token=your qiniu access key:1H-CXf0paROE2kIvGRJ4v_GlTxA=" alt></p>
<p>URL: <a href="http://soap.alertafiscalintranet.com.br/WSIntegracaoSoap.asmx" target="_blank" rel="noopener">http://soap.alertafiscalintranet.com.br/WSIntegracaoSoap.asmx</a></p>
<p>Preencher Id e Token que está na “FAQ#: 410033 — Serviço Tetra - Acesso dos Clientes”.</p>
<p><em>OBS.: Caso o cliente não estiver com os dados na FAQ solicitar ao mesmo tais informações que ele deverá adquirir com a AlertaFiscal e Atualizar a FAQ com os dados desse cliente de acordo com o padrão ja existente;</em></p>
<p>Após isso é só reiniciar o sistema e fazer a pesquisa do produto pelo ícone no cadastro do produto.</p>
<h2 id="Informacoes-para-o-Suporte"><a href="#Informacoes-para-o-Suporte" class="headerlink" title="Informações para o Suporte"></a>Informações para o Suporte</h2><ul>
<li>Essa coluna foi inseridas na base de dados para o controle de integração;<ul>
<li>FLAGTRIBUT:<ul>
<li>‘R’ (Revisado) - Cadastro já atualizado pelo Integrador com a base;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Ultimas-Funcionalidades-Adicionadas"><a href="#Ultimas-Funcionalidades-Adicionadas" class="headerlink" title="Últimas Funcionalidades Adicionadas"></a>Últimas Funcionalidades Adicionadas</h2><ul>
<li>Adicionado no log as alterações feitas no serviço (incluído na tabela logcad somente o que foi alterado do produto no serviço).</li>
</ul>
<p><strong>Tem algo que não estava no documento?</strong> Não deixe de nos avisar!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/08/08/AlertaFiscal/" data-id="ckmy23sov0001q2i0d5kdfvrt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AlertaFiscal/">AlertaFiscal</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Como-tributar" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/08/Como-tributar/" class="article-date">
  <time datetime="2020-08-08T20:19:02.000Z" itemprop="datePublished">2020-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/08/Como-tributar/">Serviço - Como tributar</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Entendendo-o-Servico"><a href="#Entendendo-o-Servico" class="headerlink" title="Entendendo o Serviço"></a>Entendendo o Serviço</h2><ul>
<li>Após o serviço ser instalado, funcionará a cada 30 minutos e são executadas 2 rotinas.</li>
<li>A primeira rotina acessa a base de dados e verifica os novos produtos cadastrados e envia-os a api da ComoTributar.</li>
<li>A segunda irá acessar a api e verificar se existem produtos que foram atualizados lá. Se existir, o serviço pega os dados dos produtos e atualiza na base local.</li>
<li>Na base local o produto tem um campo chamado ‘flagtribut’, que se estiver nulo ainda não foi enviado à api, se estiver com ‘P’ foi enviado, porém está pendente de revisão e se estiver ‘R’ já foi enviado e revisado, estando com a tributação correta.</li>
</ul>
<h2 id="Requisitos"><a href="#Requisitos" class="headerlink" title="Requisitos"></a>Requisitos</h2><p><strong>Requisitos para instalação:</strong></p>
<ul>
<li>NetFrameWork 4.7.2: <a href="https://download.microsoft.com/download/6/E/4/6E48E8AB-DC00-419E-9704-06DD46E5F81D/NDP472-KB4054530-x86-x64-AllOS-ENU.exe" target="_blank" rel="noopener">https://download.microsoft.com/download/6/E/4/6E48E8AB-DC00-419E-9704-06DD46E5F81D/NDP472-KB4054530-x86-x64-AllOS-ENU.exe</a>;</li>
<li>Sistema operacional Windows 10 ou Windows Server 2012 ou superior;</li>
<li>Sincronos SG atualizado a partir da versão 9.14.3;</li>
<li>Arquivo de instalação ‘Instalação_xxx.msi’ que está no mega na pasta SERVIÇOS/Instalador_xxx.</li>
</ul>
<h3 id="Configuracao-Servico-Automatico"><a href="#Configuracao-Servico-Automatico" class="headerlink" title="Configuração - Serviço Automático"></a>Configuração - Serviço Automático</h3><hr>
<ol>
<li>Ao executar o executável irá iniciar o processo de instalação:</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/9sstXp3.png?e=1617235479&token=your qiniu access key:ZzlXSGo6GuXvEj56LaDsmER4cvs=" alt></p>
<ol start="2">
<li>Marcar TODOS e clicar em avançar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/UxtSRtf.jpg?e=1617235479&token=your qiniu access key:SW0XSGuWGj3AS3QngAkbkfXUGSc=" alt></p>
<ol start="3">
<li>Informar dados solicitados: CNPJ do Cliente, Nome Fantasia, Nome da Base de dados e Nome da Máquina onde está instalado o SQL com essa Base;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/cfOXdCM.png?e=1617235479&token=your qiniu access key:Xd1i5kRvWGYtL0FqIOd6VkTNJVY=" alt></p>
<ol start="5">
<li>Marcar o serviço;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/dqUSzWb.png?e=1617235479&token=your qiniu access key:j9IiopNaefjFrKGh6ZbdeAlmFdU=" alt></p>
<ol start="6">
<li>Clicar em Avançar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/xgIM7GT.png?e=1617235479&token=your qiniu access key:VKBW2YwyWH7Xvfou0auNGPCU2EA=" alt></p>
<ol start="7">
<li>Caso acuse o erro da imagem a baixo, Instale o Netframework 4.7.2. Caso não dê erro, Seguir com o processo.</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/D2bkrKd.png?e=1617235479&token=your qiniu access key:P1DehyaneRKkRBTjKyVoD0VQADs=" alt></p>
<ol start="8">
<li>Clicar em Fechar;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/jfwZsYL.png?e=1617235479&token=your qiniu access key:GwsKc-JI28VhSpTV0sxc7Ip-yiM=" alt></p>
<ol start="9">
<li>Após isso vá no caminho da instalação:<br>Geralmente: (C:\Program Files (x86)\Tetra Solucoes\ServicosTetra)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Abra o arquivo 'ConfigTetra'</span></span><br><span class="line"><span class="comment"># Nele tem vários campos, mas precisaremos colocar os dados em 2 campos:</span></span><br><span class="line"><span class="comment"># 'Username' e no 'Password':</span></span><br><span class="line"></span><br><span class="line"><span class="string">"AuthEnvio"</span>: &#123;</span><br><span class="line">    <span class="string">"Client_id"</span>: <span class="string">"sistema_tetra"</span>,</span><br><span class="line">    <span class="string">"Client_secret"</span>: <span class="string">"sistema_tetra"</span>,</span><br><span class="line">    <span class="string">"Username"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Password"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Grant_type"</span>: <span class="string">"password"</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment"># Preencher Login e Senha que está na</span></span><br><span class="line"><span class="comment"># "FAQ#: 410027 — Login e Senha dos #Clientes Como Tributar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># *OBS.: Caso o cliente não estiver com os dados na FAQ solicitar</span></span><br><span class="line"><span class="comment"># ao mesmo tais informações que ele deverá adquirir com a Como Tributar</span></span><br><span class="line"><span class="comment"># e Atualizar a FAQ com os dados desse cliente de acordo com o padrão</span></span><br><span class="line"><span class="comment"># ja existente;*</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Depois de preencher os dados salve e feche o arquivo.</span></span><br></pre></td></tr></table></figure>

<ol start="10">
<li>Reinicie o serviço TETRA SERVIÇOS que está iniciado no Serviço do Windows:<ul>
<li>Abrir o executar em CTRL+R e digitar Services.msc;</li>
</ul>
</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/yel2TSq.png?e=1617235479&token=your qiniu access key:XF-KIFVFcMtrPz9SWv1o9jf0ykQ=" alt></p>
<ol start="11">
<li>Se quiser conferir o log do serviço para verificar se ocorreu algum problema pode ver o relatório no sistema em Cadastros/Estoque/Serviços/Relatório de Log de Serviços;</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/7oKHisv.png?e=1617235479&token=your qiniu access key:c-WeOckXNwSnrAbjzFrxsGGHjEY=" alt></p>
<ul>
<li><p>Só pesquisar o perídodo e o serviço a buscar que irá aparecer o log do serviço. (Esses dados são gravados na tabela SYS_LOGSERVICE)</p>
</li>
<li><p>Obs. Caso aparecer algum erro contate o setor de desenvolvimento para verificar.</p>
</li>
</ul>
<h3 id="Configuracao-Consulta-Manual"><a href="#Configuracao-Consulta-Manual" class="headerlink" title="Configuração - Consulta Manual"></a>Configuração - Consulta Manual</h3><ol>
<li>Abrir o SG, ir em Utilitários - Configuração - Sistema - Outros, verificar se a opção de integração 3 - ComoTributar está marcada e preencher os campos usuário, senha e url do serviço:</li>
</ol>
<p><img src="http://you img base url/https://i.imgur.com/RHdJ6g9.png?e=1617235479&token=your qiniu access key:-uuSyPPSB9RZQoWTgU-VOcyT6jw=" alt></p>
<p>URL: <a href="https://comotributar.redwind.com.br/api/consulta/tributacao/" target="_blank" rel="noopener">https://comotributar.redwind.com.br/api/consulta/tributacao/</a></p>
<p>Preencher Login e Senha que está na “FAQ#: 410027 — Login e Senha dos Clientes Como Tributar”.</p>
<p><em>OBS.: Caso o cliente não estiver com os dados na FAQ solicitar ao mesmo tais informações que ele deverá adquirir com a Como Tributar e Atualizar a FAQ com os dados desse cliente de acordo com o padrão ja existente;</em></p>
<p>Após isso é só reiniciar o sistema e fazer a pesquisa do produto pelo ícone no cadastro do produto.</p>
<h2 id="Informacoes-para-o-Suporte"><a href="#Informacoes-para-o-Suporte" class="headerlink" title="Informações para o Suporte"></a>Informações para o Suporte</h2><ul>
<li>Essas 4 colunas foram inseridas na base de dados para o controle de integração;<ul>
<li>FLAGTRIBUT:<ul>
<li>‘R’ (Revisado) - Cadastro ja atualizado pelo Integrador com a base Como Tributar;</li>
<li>‘P’ (Pendente) - Cadastro pendente atualização manual por parte da Como Tributar.</li>
</ul>
</li>
<li>DTTRIBUT:<ul>
<li>Data da ultima atualização de status.</li>
</ul>
</li>
<li>CODIGOTRIBUT:<ul>
<li>Código que foi enviado para a Como Tributar.</li>
</ul>
</li>
<li>FLAGINTERNOTRIBUT:<ul>
<li>0 - (EAN Valido) Código do CODIGOTRIBUT enviado (enviado codigo de barras);</li>
<li>1 - (EAN invalido) Código do CODIGOTRIBUT enviado (código interno enviado por falta de codigo de barras válido).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://you img base url/https://i.imgur.com/bC5pSXl.png?e=1617235479&token=your qiniu access key:RYj7tDe_RluF9txaIk70AJRPaZY=" alt="11"></p>
<h2 id="Ultimas-Funcionalidades-Adicionadas"><a href="#Ultimas-Funcionalidades-Adicionadas" class="headerlink" title="Últimas Funcionalidades Adicionadas"></a>Últimas Funcionalidades Adicionadas</h2><ul>
<li>Caso o cliente não queira atualizar algum produto, tem a função de ignorar atualização de produtos. Só ir no cadastro do produto e marcar essa opção na página Adicionais:</li>
</ul>
<p><img src="http://you img base url/https://i.imgur.com/qqquP8n.png?e=1617235479&token=your qiniu access key:mXnq4AZeb9bTnqHmqfsOBd-pA84=" alt></p>
<ul>
<li><p>Adicionado no log as alterações feitas no serviço (incluído na tabela logcad somente o que foi alterado do produto no serviço).</p>
</li>
<li><p>Atualizar novamente produtos editados pelo cliente. (Se o produto não estiver com a flag de revisão marcada, se o produto já for revisado pelo serviço e se o cliente editar após revisão, a flag é alterada para ‘M’ e o serviço atualiza esse produto novamente.)</p>
</li>
</ul>
<p><strong>Tem algo que não estava no documento?</strong> Não deixe de nos avisar!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/08/08/Como-tributar/" data-id="ckmy23spa000eq2i0z8rjtesm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tetra-ComoTributar-ServicoTetra/">Tetra;ComoTributar;ServicoTetra</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Comanda" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/30/Comanda/" class="article-date">
  <time datetime="2020-04-30T17:42:00.000Z" itemprop="datePublished">2020-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/30/Comanda/">Comanda eletrônica - instalação e uso</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="INSTALACAO"><a href="#INSTALACAO" class="headerlink" title="INSTALAÇÃO"></a>INSTALAÇÃO</h1><h2 id="1-API-Servidor"><a href="#1-API-Servidor" class="headerlink" title="1. API/Servidor"></a>1. API/Servidor</h2><ul>
<li><strong>Baixar e instalar a Docker</strong><ul>
<li><a href="https://docs.docker.com/install/" target="_blank" rel="noopener">https://docs.docker.com/install/</a></li>
</ul>
</li>
<li><strong>Abrir o Power Shell e colocar o seguinte comando:</strong><ul>
<li><code>docker run --name apitetra -e BD_NAME=&#39;nome-do-banco&#39; -e BD_PASS=&#39;ACESSO&#39; -e BD_HOST=&#39;127.0.0.1&#39; -e BD_USER=&#39;sa&#39; -e BD_FILIAL=&#39;1&#39; -p 8080:8080 --restart=always -d sandersoncorrea/tetra-foods-api</code></li>
<li>Esse comando baixa e instala a API que vai acessar o banco de dados na máquina.</li>
<li>Preencha os campos com as informações do banco que deseja usar. (Ex.: <code>BD_NAME=&#39;PADARIA&#39;</code>, <code>BD_PASS=&#39;ACESSO&#39;</code>, etc).</li>
<li>Os campos de devem estar entre aspas simples.</li>
<li>A api será instalada na porta que você definir. Por exemplo, se colocar <code>9090:8080</code> a API será acessada pela porta <code>9090</code>, mas o padrão é repetir o segundo número ficando <code>8080:8080</code> como na linha de comando acima. O número antes dos dois ponto (:) pode ser alterada, mas JAMAIS altera o numero depois dos dois pontos, deverá ser sempre <code>8080</code>.</li>
<li>O nome fica a escolha do agente que vai instalar, mas para manter o padrão, coloque <code>apitetra</code>. Caso vá instalar dois ou mais, coloque sufixos faceis de ser identificados.</li>
<li>A tag <code>--restart=always</code> é para que o servidor inicie junto com o Windows sempre.</li>
</ul>
</li>
<li><strong>Após o término das instalação, verifique se está rodando com</strong><ul>
<li>docker ps (no power shell)</li>
<li>Vai aparecer uma lista das dockers que estão execução. Verifique a coluna <code>status</code>.</li>
<li>Para testar, abra um navegador e entre em <code>localhost:8080</code> (com a porta que foi configurada), vai aparecer as configurações que o usuário escolheu na instalação indicando que a instalação foi bem sucedida.</li>
</ul>
</li>
</ul>
<h2 id="2-Mobile"><a href="#2-Mobile" class="headerlink" title="2. Mobile"></a>2. Mobile</h2><ul>
<li>Baixe o aplicativo em <code>https://bit.ly/app-tetra-comanda</code> e instale em um aparelho Android. As atualizações serão sempre mantidas nesse link.</li>
<li>Abra o aplicativo e vá em configurações (ícone no lado superior direito da tela de Login).</li>
<li>Preencha o campo com <code>HOST:PORTA</code>. O host é o IP da máquina na rede e a porta é a escolhida durante a instalação. Ex.: <code>10.0.0.140:8080</code>.</li>
<li>Para testar se este é realmente o IP correto, abra-o no seu navegador do celular, se abrir e mostrar as informações que foram configuradas está correta, se demorar ou não abrir pode ser que esteja errado.</li>
<li>Salve e o aplicativo está pronto para ser usado.</li>
<li>Verifique se seu banco está atualizado pois alguns campos foram adicionados especificamente para esta aplicação. Foi alterada somente a tabela <code>USUARIO</code> com os campos novos <code>SENHA_COMANDAELETRONICA (varchar(30), null)</code> ; <code>USERNAME (varchar(30), null)</code> ; <code>COMANDAELETRONICA (char(1), null)</code>.</li>
</ul>
<h2 id="3-Usando-a-aplicacao"><a href="#3-Usando-a-aplicacao" class="headerlink" title="3. Usando a aplicação"></a>3. Usando a aplicação</h2><ul>
<li>Faça o login com as credenciais cadastradas no SG nos campos novos da tabela <code>USUARIO</code>. O usuário só conseguirá acesso se colocar o username e senha corretos e se estiver habilitado a ter acesso <code>(COMANDAELETRONICA == 1)</code></li>
<li>O aplicativo é para auxiliar nos pedidos de pré-venda</li>
<li>Todos os pedidos serão salvos na tabela DAVPRE</li>
<li>A entrada são de dois modos, ou inicia uma comanda/pré venda ou abre uma que já exista.</li>
<li>Se for abrir uma nova o número vai iniciar com 0 e na primeira vez que salvar o aplicativo vai voltar a tela inicial já com o numero novo.</li>
<li>Se abrir uma comanda já existente, vai adicionar novos produtos.</li>
<li>A tela de produtos disponíveis somente mostrarão os produtos com <code>situação A</code> e <code>marcados para WEB (prodweb = 1)</code></li>
</ul>
<h2 id="4-O-que-muda-no-SG"><a href="#4-O-que-muda-no-SG" class="headerlink" title="4. O que muda no SG"></a>4. O que muda no SG</h2><ul>
<li>A base de dados conta com 3 campos novos na tabela USUARIO, são eles - <code>SENHA_COMANDAELETRONICA (varchar(30), null)</code> ; <code>USERNAME (varchar(30), null)</code> ; <code>COMANDAELETRONICA (char(1), null)</code>;</li>
<li>Esses campos devem ser preenchidos dentro do SG e será usado para autenticação no Mobile e na API</li>
<li>O APP também usa as tabela DavPre, DavPreItem, DavPreItemExcecao, Grupo, Subgrupo, SubgrupoExececao, UltReg.</li>
</ul>
<h2 id="5-Escalabilidade"><a href="#5-Escalabilidade" class="headerlink" title="5. Escalabilidade"></a>5. Escalabilidade</h2><ul>
<li>A API foi pensando em um modo que seja facilmente escalável. O uso da Docker facilita pois é possível montar quantos servidores quiser, desde que a máquina aguente, com variados bancos e variadas filiais.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/04/30/Comanda/" data-id="ckmy23sp7000aq2i0q93w3kp3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Comanda/">Comanda</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-conciliador-cartao" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/03/conciliador-cartao/" class="article-date">
  <time datetime="2020-02-03T15:18:47.000Z" itemprop="datePublished">2020-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/03/conciliador-cartao/">CONCILIADOR de cartão</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Funcao-conciliar-administrar-vendas-de-cartao"><a href="#Funcao-conciliar-administrar-vendas-de-cartao" class="headerlink" title="Função: conciliar/administrar vendas de cartão"></a>Função: conciliar/administrar vendas de cartão</h3><h3 id="Onde-instalar-instalador-padrao-dos-ServicoTetra-msi"><a href="#Onde-instalar-instalador-padrao-dos-ServicoTetra-msi" class="headerlink" title="Onde instalar: instalador padrão dos ServiçoTetra.msi"></a>Onde instalar: instalador padrão dos ServiçoTetra.msi</h3><h3 id="Instalacao"><a href="#Instalacao" class="headerlink" title="Instalação"></a>Instalação</h3><p>Se instala como os outros serviços, se atentando aos<br>dados obrigatórios que são: CNPJ, Nome Fantasia, Banco de dados(local), Server(local), Filial, LoginConcialidor, SenhaConciliador e marcar ‘true’ em ‘Conciliador’. Cnpj, nome, bd e server e Conciliador estão na tela de instalação. Filial, login e senha é necessário abrir o config para preencher.</p>
<h3 id="Funcionamento"><a href="#Funcionamento" class="headerlink" title="Funcionamento"></a>Funcionamento</h3><p>O conciliador é um serviço que o cliente contrata de forma direta com o Conciliador. A empresa contém todos os registros de compras feitas em cartão e a função do serviço é enviar as informações de vendas que temos no SG para fazer a comparação e saber se essas vendas foram pagas pela operadora de cartão de forma corretas (valor e data).</p>
<p>Se estiverem corretas as vendas, o serviço vai gerar o recebido e quitar as vendas que devam ser quitadas. Se estiver faltando algum valor, no LOG estará informando o valor esperado e o valor que na realidade foi recebido.</p>
<h6 id="Rotinas"><a href="#Rotinas" class="headerlink" title="Rotinas"></a>Rotinas</h6><ul>
<li>A rotina é realizada na madrugada para evitar congestionamento</li>
<li>São duas rotinas</li>
</ul>
<ol>
<li>O serviço pega todas as vendas no SG do ultimos 4 dias e as envia para o conciliador. Nos casos de teste não há problema se enviar vendas repetidas, o conciliador sabe lidar com isso.</li>
<li>O serviço pega as vendas no concilia que venceria no ultimos 4 dias e verifica se foi recebido de forma correta, se sim, quita.</li>
</ol>
<h3 id="Informacoes"><a href="#Informacoes" class="headerlink" title="Informações"></a>Informações</h3><ul>
<li><p>Para saber se as quitações estão corretas poderá ser visto os valores no LOG e comparar com outros relatórios do SG. Mas atenção, como a rotina roda todos os dias nos últimos 4 dias, o mesmo dia será verificado por 4 vezes, então valores do mesmo dia de vencimento pode ser identificado em dias diferentes, então o total é a soma desses dias. Exemplo</p>
<blockquote>
<p>Hoje rodei o serviço, dia 5, então serão verificados os dias 2, 3, 4 e 5. Amanhã serão os dias 3, 4, 5, e 6; depois 4, 5, 6 e 7; depois 5, 6, 7 e 8. Note que o dia 5 apareceu 4 vezes e depois não vai aparecer mais. Sendo assim, pode acontecer que na primeira a maior parte das vendas sejam identificadas, mas no dia seguinte, mais algumas vendas e no outro mais algumas. Basta somar os dias para saber qual o valor das vendas foram quitadas pelo conciliador.</p>
</blockquote>
</li>
<li><p>Também é possível comparar as vendas com o relatório que o site do Concilia gera</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sincronos.github.io/2020/02/03/conciliador-cartao/" data-id="ckmy23spj000jq2i04caxumem" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AlertaFiscal/">AlertaFiscal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Comanda/">Comanda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tetra-ComoTributar-ServicoTetra/">Tetra;ComoTributar;ServicoTetra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TetraSonar/">TetraSonar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fiscal/">fiscal</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AlertaFiscal/" style="font-size: 10px;">AlertaFiscal</a> <a href="/tags/Comanda/" style="font-size: 10px;">Comanda</a> <a href="/tags/Tetra-ComoTributar-ServicoTetra/" style="font-size: 10px;">Tetra;ComoTributar;ServicoTetra</a> <a href="/tags/TetraSonar/" style="font-size: 10px;">TetraSonar</a> <a href="/tags/fiscal/" style="font-size: 10px;">fiscal</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/31/Acerto/">Acerto Fiscal - Integração</a>
          </li>
        
          <li>
            <a href="/2021/03/31/GestaoSoftware/">Gestao de Software - Tetra</a>
          </li>
        
          <li>
            <a href="/2021/02/24/Audittar/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/02/19/Scantech/">SCANTECH</a>
          </li>
        
          <li>
            <a href="/2020/11/03/Clubiz/">CLUBIZ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Carlos Viana<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>